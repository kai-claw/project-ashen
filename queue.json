{
  "phase": 27,
  "name": "Minimap & World Map",
  "hotfixes": [
    {
      "id": "terrain-spawn-fix",
      "name": "Render Pipeline Fix (was: Terrain Spawn Fix)",
      "priority": "P0",
      "status": "ready-for-review",
      "worker": 1,
      "description": "Fix black screen / green sphere bug \u2014 EffectComposer render target misconfigured",
      "workerNotes": "ROOT CAUSE FOUND: EffectComposer was constructed with a custom WebGLRenderTarget using colorSpace: SRGBColorSpace + RGBAFormat (8-bit). In Three.js r182, this creates a color space mismatch with UnrealBloomPass internal render targets (which default to LinearSRGBColorSpace), causing black output from frame 6 onward. FIX: Let EffectComposer create its own default render target (HalfFloatType, LinearSRGBColorSpace). Also removed 400+ lines of spawn-Y-tweaking code accumulated over 38 failed attempts that were treating the symptom not the cause. Cleaned up debug cubes, debug overlays, aggressive camera clamping (ABSOLUTE_MIN=60). Commit 4c88430."
    }
  ],
  "subtasks": [
    {
      "id": "minimap-core",
      "name": "MinimapManager.js",
      "priority": "P0",
      "status": "ready-for-review",
      "worker": 1,
      "description": "Create MinimapManager.js: 150px circular minimap, orthographic top-down view, player arrow, zoom levels, biome coloring, M key toggle",
      "workerNotes": "Created MinimapManager.js with: (1) 150px circular minimap in top-right corner with dark fantasy border, (2) Real-time terrain rendering using canvas with biome colors (castle, meadow, grassland, woods, frontier), (3) Height-based shading for terrain depth, (4) Player arrow indicator always centered pointing forward, (5) Three zoom levels (50m/100m/200m) - click to cycle, (6) M key to toggle visibility, (7) North indicator, (8) Camera-relative rotation (forward always up), (9) Legend panel with icon descriptions, (10) Right-click to place custom waypoint, (11) Icon system foundation for phase 2, (12) Added getVillagePositions() to VillageManager, (13) Added getDungeonEntrances() to DungeonManager"
    },
    {
      "id": "minimap-icons",
      "name": "Minimap Icons",
      "priority": "P0",
      "status": "ready-for-review",
      "worker": 1,
      "description": "Add icons to minimap: enemies, NPCs, quest markers, villages, dungeons, gathering nodes, bosses, waypoints, legend",
      "workerNotes": "Enhanced icon system: (1) Enemy red dots with threat-based sizing, (2) NPC green/yellow dots (quest givers highlighted), (3) Quest objective markers using QuestManager.getQuestMarkers(), (4) Village house icons, (5) Dungeon skull icons, (6) Gathering node toggle, (7) Boss skull icons, (8) Bonfire/crucible flame icons, (9) Custom waypoint with right-click, (10) Edge fade for icons near radius, (11) Added getActiveNodes() to GatheringManager, (12) Added getDiscoveredBonfires() to GameManager"
    },
    {
      "id": "fast-travel",
      "name": "FastTravelManager.js",
      "priority": "P1",
      "status": "ready-for-review",
      "worker": 1,
      "description": "Fast travel system: discovered crucibles/bonfires, click-to-travel, confirmation dialog, loading tips, transition effects",
      "workerNotes": "Created FastTravelManager.js with: (1) Location discovery system with localStorage persistence, (2) Starting bonfire auto-discovered, (3) Discovery notification popup, (4) Confirmation dialog showing destination and distance, (5) Combat/dungeon/boss fight restrictions, (6) Fade out/in transitions (1s each), (7) Loading screen with random gameplay tips from 20+ tips pool, (8) Progress bar animation, (9) Chunk refresh after teleport (terrain, foliage, villages, ruins, caves), (10) Autosave trigger after arrival, (11) Arrival notification, (12) Double-click on minimap bonfires triggers fast travel, (13) Waypoint travel support, (14) Save/load data integration, (15) ESC to cancel confirmation"
    },
    {
      "id": "world-map-ui",
      "name": "WorldMapUI.js",
      "priority": "P0",
      "status": "ready-for-review",
      "worker": 2,
      "description": "Full-screen map overlay (Tab key toggle), pan/zoom, fog of war, region names, filter buttons, search function",
      "workerNotes": "Created WorldMapUI.js with: (1) Full-screen overlay with Tab key toggle, (2) Mouse drag + WASD panning, (3) Scroll wheel zoom with 4 levels (0.5x, 1x, 2x, 4x), (4) Terrain rendering with biome colors, (5) Fog of war integration with DiscoveryManager, (6) Region names displayed at centers, (7) Sidebar with filter buttons (quests, NPCs, villages, dungeons, bonfires, resources, bosses), (8) Legend showing all icon types, (9) Search function with dropdown results, (10) Coordinate display on hover, (11) Click POI for details, (12) Double-click bonfires for fast travel, (13) Exploration progress stats, (14) C key to center on player, (15) Save/load zoom and pan position"
    },
    {
      "id": "discovery-system",
      "name": "DiscoveryManager.js",
      "priority": "P0",
      "status": "ready-for-review",
      "worker": 2,
      "description": "Track explored areas, reveal map as player explores, discovery notifications, XP bonus, save/load state",
      "workerNotes": "Created DiscoveryManager.js with: (1) Chunk-based exploration tracking (20m chunks), (2) 50m reveal radius around player, (3) Three fog levels: unexplored (black), seen (dim), current (clear), (4) 'Location Discovered' notifications with icons and XP rewards, (5) Discovery XP bonuses (villages 50XP, dungeons 75XP, bonfires 25XP, regions 100XP), (6) Region discovery tracking with progress percentage, (7) Region completion rewards (250XP), (8) World completion achievement (1000XP), (9) Auto-reveal around villages, (10) Save/load discovery state with compressed chunk data, (11) Exploration stats API for UI integration, (12) Quest system hooks for exploration quests"
    },
    {
      "id": "map-polish",
      "name": "Map Polish",
      "priority": "P1",
      "status": "ready-for-review",
      "worker": 2,
      "description": "Minimap transparency slider, map legend, coordinate display, quest path lines, achievements",
      "workerNotes": "Added polish features: (1) Minimap opacity/transparency control with localStorage persistence, (2) Map legend already exists with all icon types, (3) Coordinate display on hover in world map, (4) Waypoint distance display below minimap, (5) Quest path lines (dashed gold lines from player to objectives), (6) Map ping system (Ctrl+click to ping location, syncs between minimap and world map), (7) Pings pulse and fade over 3-5 seconds, (8) Mobile-friendly controls via touch events for pan, (9) Build verified, deployed to gh-pages"
    }
  ],
  "lastUpdated": "2026-02-19T10:52:00Z",
  "workerStatus": "Worker 1: DIAGNOSTIC DEPLOY (commit 9081934). Added: (1) Red MeshBasicMaterial 10x10x10 cube at (0,20,0) — visible regardless of lighting/fog. (2) scene.children count, camera near/far, player pos. (3) scene.background + scene.fog after DayNightLighting init. (4) renderer toneMapping/exposure/outputColorSpace. (5) composer passes list. (6) World constructor scene reference verify. (7) TerrainGenerator chunk-add logs. (8) DayNightLighting phase + light intensities. OBSERVATIONS FROM CODE REVIEW: scene.background starts 0x87CEEB (sky blue), DayNightLighting.setPhaseImmediate(DAY) sets it to 0x87ceeb — looks correct. Fog is FogExp2 with density 0.008 — reasonable. Camera near=0.1, far=500 — should show cube at y=20. World._createLighting adds DUPLICATE lights (sunLight, ambientLight, hemiLight, fillLight) on top of DayNightLighting's own lights — possible overexposure but not blackness. Need browser console output to proceed. Status: diagnostic deployed, awaiting console output."
}