{
  "phase": 26,
  "name": "Save System & Persistence",
  "subtasks": [
    {
      "id": "save-data-schema",
      "name": "SaveDataSchema.js",
      "priority": "P0",
      "status": "ready-for-review",
      "worker": 1,
      "description": "Define complete save data structure covering ALL game systems",
      "workerNotes": "Created SaveDataSchema.js with: (1) SAVE_VERSION=1 for migration support, (2) SAVE_SLOT_TYPE enum (manual/autosave), (3) Complete default data structures: getDefaultPlayerData (position, rotation, checkpoint, health/stamina/mana/posture, level, XP, remnant, stat points, infusions, abilities, spells, death tracking, bloodstain), getDefaultInventoryData (gold, items, equipment, weapons, boss souls, trophies, keys), getDefaultEquipmentData (equipped weapon/armor/accessory, weapon quick-slots 1-4, potion slots), getDefaultQuestData (active quests with state, completed/failed/available quests, cooldowns, tracked quests, stats), getDefaultReputationData (5 factions, titles, milestones, achievements), getDefaultWorldData (time: hour/minute/day/phase/moon, weather, discovered locations, fast travel, world flags, bosses defeated, dungeon states, NPC states, rare events), getDefaultCraftingData (unlocked recipes, stats, stations), getDefaultGatheringData (node cooldowns, stats, rare nodes), getDefaultCombatData (kill counts, boss kills, damage stats, records), getDefaultShopData (purchased items, refresh times, total gold spent), getDefaultSettingsData (audio, graphics, gameplay, UI), (4) createSaveMetadata() for quick slot info (slot ID, timestamp, playtime, level, location, quests/bosses counts), (5) createDefaultSaveData() to create complete save object, (6) validateSaveData() with error/warning arrays checking version, required sections, player data validity, (7) migrateSaveData() for version migrations with applied list, (8) createSaveDelta()/applySaveDelta() for delta compression between saves, (9) Helper utilities: cloneSaveData (deep clone), getSaveDataSize, formatPlaytime (HH:MM:SS), formatTimestamp"
    },
    {
      "id": "save-manager",
      "name": "SaveManager.js",
      "priority": "P0",
      "status": "ready-for-review",
      "worker": 1,
      "description": "3 manual save slots + 1 autosave, LZString compression, localStorage, import/export",
      "workerNotes": "Created SaveManager.js with: (1) 3 manual save slots (1-3) + 1 autosave slot (0), (2) LZString compression (compressToUTF16/decompressFromUTF16) for efficient localStorage, (3) save(slotId, options) - gathers all game state, validates, compresses, stores in localStorage, updates metadata cache, emits events, (4) load(slotId) - reads compressed data, decompresses, validates, migrates if needed, distributes to all managers, (5) deleteSave(slotId) - removes from localStorage and cache, (6) getSaveInfo(slotId) - returns metadata without full load, (7) listSaves() - returns all slot metadata array for UI, (8) getMostRecentSave() - finds latest save for Continue button, (9) hasSaves() - checks if any saves exist, (10) Autosave: 5-minute interval timer, triggerAutosave(reason), start/stopAutosaveTimer, (11) Save blocking: blockSaving(reason), unblockSaving(), canSave() for combat/cutscene prevention, (12) exportSave(slotId) - creates downloadable JSON file with timestamp, (13) importSave(slotId, file) - reads file, validates, migrates, stores, updates metadata, (14) gatherGameState() - collects state from all systems (gameManager, player position, manaManager, spellManager, lootManager, equipmentManager, questManager, questRewards, timeManager, weatherManager, bossSpawner, dungeonManager, craftingManager, gatheringManager, shopManager), (15) distributeGameState() - restores all state to systems with proper type conversion (Set, Map), (16) Event system: onSaveStart/onSaveComplete/onSaveError/onLoadStart/onLoadComplete/onLoadError/onAutosaveTrigger, (17) attemptRecovery() for corrupt save handling with multiple decompression methods, (18) Playtime tracking with getCurrentPlaytime() and getFormattedPlaytime(), (19) Metadata persistence in separate localStorage key, (20) 5MB max save size limit"
    },
    {
      "id": "save-integration",
      "name": "SaveIntegration.js",
      "priority": "P1",
      "status": "ready-for-review",
      "worker": 1,
      "description": "Hook autosave triggers, menus, UI indicators, combat/cutscene blocking",
      "workerNotes": "Created SaveIntegration.js with: (1) Main Menu overlay: Continue (loads most recent), New Game (with confirm if saves exist), Load Game, Settings placeholder, (2) Pause Menu overlay (ESC key): Resume, Save Game, Load Game, Settings, Return to Main Menu (with confirm), playtime display, (3) Load Menu: all 4 slots with metadata (level, location, playtime, timestamp), Load/Delete/Export buttons per slot, Import Save button with file picker, (4) Save Menu: 3 manual slots, Save/Overwrite with confirm dialog, (5) 'Saving...' indicator: top-right animated badge with pulse icon, auto-hides after 1 second, (6) Autosave triggers: village entry (50 unit radius check), quest completion hook, 5-minute timer, (7) Combat/cutscene/dialogue blocking: onCombatStart/End, onCutsceneStart/End, onDialogueStart/End, updates saveManager.blockSaving(), (8) updatePlayerPosition() for position-based triggers, (9) Quick Save (F5) to slot 1, Quick Load (F9) from most recent, (10) Tutorial first-save prompt: shows on first village visit with Save Now/Later buttons, persists shown state, (11) Death screen integration placeholder (addLoadButtonToDeathScreen), (12) Confirm dialog system for destructive actions, (13) Notification toasts for save/load success/errors, (14) Full CSS styling matching game aesthetic (Cinzel font, dark souls palette, animations), (15) Keyboard shortcuts: ESC for pause/back, F5 quick save, F9 quick load, (16) hideAllMenus() for clean state transitions, (17) Game pause state management with timeManager integration"
    }
  ],
  "lastUpdated": "2026-02-15T02:10:00Z",
  "workerStatus": "All 3 subtasks ready-for-review. Build verified ✓ Deploy verified ✓ Committed ✓"
}
